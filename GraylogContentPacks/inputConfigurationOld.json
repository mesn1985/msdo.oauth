{
  "v": 1,
  "id": "0721bdd1-9e5a-4daf-af69-9930dcfae799",
  "rev": 1,
  "name": "OAuthTokenTracing",
  "summary": "Content pack  used for  tracing OAuth token flows",
  "description": "",
  "vendor": "MESN",
  "url": "",
  "parameters": [],
  "entities": [
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "93c93ee9-3224-43b4-a2bf-fd4a086028d9",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Protected resource  retrieved"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Protected resource  retrieved\"\nwhen\n  contains(\n  value: to_string($message.\"message\"),\n  search: \"Protected Resource retrieved\",\n  ignore_case: false\n)\nthen\n  set_field(\n    field : \"isPartOfOAuthTokenFlow\",\n    value : \"true\",\n    clean_field : false\n  );\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "e540b297-1a0e-4ea6-b80a-59d56e943539",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Client obtained access token"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Client obtained access token\"\nwhen\n  contains(\n  value: to_string($message.\"message\"),\n  search: \"Obtained Access token\",\n  ignore_case: false\n)\nthen\n  set_field(\n    field : \"isPartOfOAuthTokenFlow\",\n    value : \"true\",\n    clean_field : false\n  );\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "input",
        "version": "1"
      },
      "id": "a3259c16-2b76-40ac-9de3-562a5d167771",
      "data": {
        "title": {
          "@type": "string",
          "@value": "OAuthTracing"
        },
        "configuration": {
          "recv_buffer_size": {
            "@type": "integer",
            "@value": 262144
          },
          "port": {
            "@type": "integer",
            "@value": 12201
          },
          "number_worker_threads": {
            "@type": "integer",
            "@value": 8
          },
          "charset_name": {
            "@type": "string",
            "@value": "UTF-8"
          },
          "bind_address": {
            "@type": "string",
            "@value": "0.0.0.0"
          },
          "decompress_size_limit": {
            "@type": "integer",
            "@value": 8388608
          }
        },
        "static_fields": {},
        "type": {
          "@type": "string",
          "@value": "org.graylog2.inputs.gelf.udp.GELFUDPInput"
        },
        "global": {
          "@type": "boolean",
          "@value": false
        },
        "extractors": []
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "9d39adca-f2d3-4d11-96fc-46faa96dd159",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Is client requesting access token"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Is client requesting access token\"\nwhen\n  contains(\n  value: to_string($message.\"message\"),\n  search: \"Requesting access token\",\n  ignore_case: false\n)\nthen\n  set_field(\n    field : \"isPartOfOAuthTokenFlow\",\n    value : \"true\",\n    clean_field : false\n  );\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "2394c030-f082-49b2-a095-e52280002b12",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Authorized request for protected resource was made"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Authorized request for protected resource was made\"\nwhen\n  contains(\n  value: to_string($message.\"message\"),\n  search: \"Authorized Request for protected resource\",\n  ignore_case: false\n)\nthen\n  set_field(\n    field : \"isPartOfOAuthTokenFlow\",\n    value : \"true\",\n    clean_field : false\n  );\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "2728de04-6c7c-47cb-b6df-1832aaec0b35",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Drop messages without correlation id value"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Drop messages without correlation id value\"\nwhen\n  is_null($message.\"CorrelationId\")\nthen\n  drop_message();\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "937dba3d-5d51-47db-9461-25234000a228",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Authorization Server  issued a token for client"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Authorization Server  issued a token for client\"\nwhen\n  contains(\n  value: to_string($message.\"message\"),\n  search: \"Access token issued for\",\n  ignore_case: false\n)\nthen\n  set_field(\n    field : \"isPartOfOAuthTokenFlow\",\n    value : \"true\",\n    clean_field : false\n  );\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "1b2f2922-2d1d-4bf7-961b-71607eb7ba22",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Client requests access to protected resource"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Client requests access to protected resource\"\nwhen\n  contains(\n  value: to_string($message.\"message\"),\n  search: \"Request for protected resource sent\",\n  ignore_case: false\n)\nthen\n  set_field(\n    field : \"isPartOfOAuthTokenFlow\",\n    value : \"true\",\n    clean_field : false\n  );\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline",
        "version": "1"
      },
      "id": "5a1c3014-422e-4b68-89a0-d1d7e6a8b2a7",
      "data": {
        "title": {
          "@type": "string",
          "@value": "OAuthTokenTracingPipeline"
        },
        "description": {
          "@type": "string",
          "@value": "pipeline  used for OAuth token tracing"
        },
        "source": {
          "@type": "string",
          "@value": "pipeline \"OAuthTokenTracingPipeline\"\nstage 0 match pass\nrule \"Drop messages without correlation id value\"\nstage 2 match all\nrule \"Add false value to isPartOfOAuthFlow field\"\nstage 1 match pass\nrule \"Is client requesting access token\"\nrule \"Authorization Server  issued a token for client\"\nrule \"Client obtained access token\"\nrule \"Client requests access to protected resource\"\nrule \"Authorized request for protected resource was made\"\nrule \"Protected resource  retrieved\"\nend"
        },
        "connected_streams": [
          {
            "@type": "string",
            "@value": "000000000000000000000001"
          }
        ]
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "78cc15a6-a614-456a-9f66-d7dc1c0d6323",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Add false value to isPartOfOAuthFlow field"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Add false value to isPartOfOAuthFlow field\"\nwhen\n  is_null($message.\"isPartOfOAuthTokenFlow\")\nthen\n  set_field(\n    field : \"isPartOfOAuthTokenFlow\",\n    value : \"false\",\n    clean_field : false\n  );\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.2.7+5e29a2c"
        }
      ]
    }
  ]
}